<!DOCTYPE html>
<html>
<head>
    <title>Generador Automático JSON</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <h2>Automatizador de Registro Cuenca 2026</h2>
    <input type="file" id="excel_import" accept=".xlsx, .csv" />
    <pre id="json_output" style="background: #222; color: #fff; padding: 20px; border-radius: 10px; overflow: auto; max-height: 500px;"></pre>

<script>
    document.getElementById('excel_import').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            
            // Leemos como matriz (fila por fila)
            const rows = XLSX.utils.sheet_to_json(worksheet, {header: 1});
            
            // Saltamos la fila 0 (cabeceras)
            const dataRows = rows.slice(1);

            const finalData = dataRows.map(row => {
                // Si la columna de Empresa (row[1]) está vacía, ignoramos la fila
                if (!row[1]) return null;

                return {
                    id: row[0] || "",
                    empresa: String(row[1]).trim(),
                    direccion: row[2] || "",      // DIRECCIÓN
                    municipio: row[3] || "",      // MUNICIPIO
                    cp: row[4] || "",             // CODIGO POSTAL
                    ssocial: row[5] || "",        // SSOCIAL
                    cif: row[6] || "",            // CIF
                    trabajadores: row[7] || "",   // TRABAJADORES
                    cnae: row[8] || "",           // CNAE
                    sector: row[9] || "",         // sector
                    blanca: row[10] || "",        // blanca
                    // Mantenemos 'tipo' para la lógica de colores de tu web
                    tipo: String(row[10] || "").trim().toLowerCase() === "no" ? "BLANCA" : "SI"
                };
            }).filter(e => e !== null);

            document.getElementById('json_output').textContent = "const empresas = " + JSON.stringify(finalData, null, 2) + ";";
        };
        reader.readAsArrayBuffer(file);
    });
</script>

</body>
</html>
