<!DOCTYPE html>
<html>
<head>
    <title>Generador Automático JSON</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <h2>Automatizador de Registro Cuenca 2026</h2>
    <input type="file" id="excel_import" accept=".xlsx, .csv" />
    <pre id="json_output" style="background: #222; color: #fff; padding: 20px; border-radius: 10px; overflow: auto; max-height: 500px;"></pre>

<script>
    document.getElementById('excel_import').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            
            // Leemos como matriz para no depender de nombres de cabecera
            const rows = XLSX.utils.sheet_to_json(worksheet, {header: 1});
            
            // Filtramos para quitar la fila de cabecera y filas vacías
            const dataRows = rows.slice(1);

            const finalData = dataRows.map(row => {
                // Si la fila no tiene al menos el nombre de la empresa, la saltamos
                if (!row[1] || row[1] === "EMPRESA") return null;

                return {
                    id: row[0] || "S/N",                  // Columna A: Id
                    empresa: String(row[1]).trim(),       // Columna B: EMPRESA
                    municipio: row[3] || "Desconocido",   // Columna D: MUNICIPIO
                    cif: row[6] || "N/A",                 // Columna G: CIF
                    actividad: row[9] || "Sin actividad", // Columna J: sector
                    // Columna K: blanca. Si pone "No", es BLANCA. Si no, SI.
                    tipo: String(row[10] || "").trim().toLowerCase() === "no" ? "BLANCA" : "SI"
                };
            }).filter(e => e !== null);

            document.getElementById('json_output').textContent = "const empresas = " + JSON.stringify(finalData, null, 2) + ";";
        };
        reader.readAsArrayBuffer(file);
    });
</script>    
</body>
</html>
