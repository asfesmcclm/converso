<!DOCTYPE html>
<html>
<head>
    <title>Generador Automático JSON</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <h2>Automatizador de Registro Cuenca 2026</h2>
    <input type="file" id="excel_import" accept=".xlsx, .csv" />
    <pre id="json_output" style="background: #222; color: #fff; padding: 20px; border-radius: 10px; overflow: auto; max-height: 500px;"></pre>

<script>
    document.getElementById('excel_import').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            
            // Leemos como matriz para ignorar nombres de cabecera que den error
            const rows = XLSX.utils.sheet_to_json(worksheet, {header: 1});
            
            // Saltamos la fila de títulos (fila 0)
            const dataRows = rows.slice(1);

            const finalData = dataRows.map(row => {
                // Si la columna B (Empresa) está vacía, ignoramos la fila
                if (!row[1] || row[1] === "EMPRESA") return null;

                return {
                    id: row[0] || "",             // Columna A (Id)
                    empresa: String(row[1]).trim(), // Columna B (EMPRESA)
                    direccion: row[2] || "",      // Columna C (DIRECCIÓN)
                    municipio: row[3] || "",      // Columna D (MUNICIPIO)
                    cp: row[4] || "",             // Columna E (CP)
                    ssocial: row[5] || "",        // Columna F (SSOCIAL)
                    cif: row[6] || "",            // Columna G (CIF)
                    trabajadores: row[7] || "",   // Columna H (TRABAJADORES)
                    cnae: row[8] || "",           // Columna I (CNAE)
                    sector: row[9] || "",         // Columna J (sector)
                    blanca: row[10] || "",        // Columna K (blanca)
                    // Lógica para el color del marcador en tu mapa
                    tipo: String(row[10] || "").trim().toLowerCase() === "no" ? "BLANCA" : "SI"
                };
            }).filter(e => e !== null);

            // Esto limpia lo anterior y pone lo nuevo
            const outputElement = document.getElementById('json_output');
            outputElement.textContent = ""; 
            outputElement.textContent = "const empresas = " + JSON.stringify(finalData, null, 2) + ";";
        };
        reader.readAsArrayBuffer(file);
    });
</script>
</body>
</html>
