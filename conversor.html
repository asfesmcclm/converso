<!DOCTYPE html>
<html>
<head>
    <title>Generador Automático JSON</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <h2>Automatizador de Registro Cuenca 2026</h2>
    <input type="file" id="excel_import" accept=".xlsx, .csv" />
    <pre id="json_output" style="background: #222; color: #fff; padding: 20px; border-radius: 10px; overflow: auto; max-height: 500px;"></pre>

<script>
    document.getElementById('excel_import').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            
            // Forzamos a que lea el Excel como una matriz (fila por fila)
            // Esto evita problemas con los nombres de las cabeceras
            const rows = XLSX.utils.sheet_to_json(worksheet, {header: 1});
            
            // Quitamos la primera fila (que son los títulos)
            const dataRows = rows.slice(1);

            const finalData = dataRows.map(row => {
                // row[0] es la 1ª columna (Id), row[1] la 2ª (Empresa), etc.
                if (!row[1]) return null; // Si no hay nombre de empresa, ignoramos la fila

                return {
                    id: row[0] || "S/N",
                    empresa: String(row[1]).trim(),
                    municipio: row[3] || "Desconocido", // Columna D
                    cif: row[6] || "N/A",               // Columna G
                    actividad: row[9] || "Sin actividad", // Columna J (sector)
                    // Columna K (blanca): Si pone "No", es tipo BLANCA
                    tipo: String(row[10] || "").trim().toLowerCase() === "no" ? "BLANCA" : "SI"
                };
            }).filter(e => e !== null);

            document.getElementById('json_output').textContent = "const empresas = " + JSON.stringify(finalData, null, 2) + ";";
        };
        reader.readAsArrayBuffer(file);
    });
</script>
</body>
</html>
